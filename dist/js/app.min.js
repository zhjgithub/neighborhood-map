function initLocationsData(){var o,e=window.localStorage.getItem("interestLocations");null===e?(o=[["Park Ave Penthouse",40.7713024,-73.9632393,"building"],["Chelsea Apartments",40.7444883,-73.9949465,"building"],["Union Square Open Floor Plan",40.7347062,-73.9895759,"building"],["Momofuku Noodle Bar",40.729246,-73.984444,"food"],["Gary Graham",40.719562,-74.009226,"shopping"],["Deluxe Food Market",40.71804,-73.996257,"grocery"]],window.localStorage.setItem("interestLocations",JSON.stringify(o))):o=JSON.parse(e);for(var n=0;n<o.length;n++){var t=o[n];initialLocations.push({title:t[0],location:{lat:t[1],lng:t[2]},type:t[3]})}}function initMap(){function o(){for(var o,e=new google.maps.LatLngBounds,n=0;n<markers.length;n++)o=markers[n],e.extend(o.position);map.fitBounds(e)}function e(){var o=0;"number"==typeof window.innerWidth?o=window.innerHeight:document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?o=document.documentElement.clientHeight:document.body&&(document.body.clientWidth||document.body.clientHeight)&&(o=document.body.clientHeight),o-=48,document.getElementById("map").style.height=o+"px"}geocoder=new google.maps.Geocoder,map=new google.maps.Map(document.getElementById("map"),{center:{lat:40.7413549,lng:-73.9980244},zoom:13,mapTypeControlOptions:{position:google.maps.ControlPosition.RIGHT_TOP}}),e(),window.onresize=function(){e(),map&&(google.maps.event.trigger(map,"resize"),o())},largeInfoWindow=new google.maps.InfoWindow;var n="https://maps.google.com/mapfiles/kml/shapes/",t={building:{icon:n+"homegardenbusiness_maps.png"},food:{icon:n+"dining_maps.png"},grocery:{icon:n+"grocery_maps.png"},shopping:{icon:n+"shopping_maps.png"}};initialLocations.forEach(function(o,e){var n=new google.maps.Marker({position:o.location,title:o.title,animation:google.maps.Animation.DROP,icon:t[o.type].icon});markers.push(n),n.addListener("click",function(){populateInfoWindow(this,largeInfoWindow)})}),function(o){for(var e,n=new google.maps.LatLngBounds,t=0;t<o.length;t++)(e=o[t]).setMap(map),n.extend(e.position);map.fitBounds(n)}(markers)}function populateInfoWindow(o,e){e.marker==o&&e.map||(e.marker=o,e.setContent('<div id="infowindow-title">'+o.title+'</div><div id="address"></div><div id="photo-pane"></div>'),function(o){geocoder.geocode({location:o.getPosition()},function(n,t){t==google.maps.GeocoderStatus.OK?e.marker==o&&(document.getElementById("address").innerHTML=n[0].formatted_address):t==google.maps.GeocoderStatus.ZERO_RESULTS?window.alert("Could Not Find The Location"):window.alert("Google Map Geocoder Failed")})}(o),function(o){var n="https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=22caee340c6b324e3ca01e22c4a425ae&format=json&nojsoncallback=1&"+$.param({text:o.title,lat:o.getPosition().lat(),lon:o.getPosition().lng()});$.getJSON(n,function(n){if("ok"===n.stat){if(e.marker!=o)return;if(n.photos.photo.length>0){var t=n.photos.photo[0],i="https://farm{farm-id}.staticflickr.com/{server-id}/{id}_{secret}.jpg";i=i.replace("{farm-id}",t.farm).replace("{server-id}",t.server).replace("{id}",t.id).replace("{secret}",t.secret),document.getElementById("photo-pane").innerHTML='<div> Photo From Flickr </div><img id="photo" src="'+i+'">'}else document.getElementById("photo-pane").innerHTML="<div> No Photo For This Location </div>"}else window.alert("Photo From Flickr Could Not Be Loaded")}).fail(function(o){window.alert("Get Photo From Flickr Failed")})}(o),e.open(map,o),function(o){selectedMarker&&selectedMarker!=o&&null!==selectedMarker.getAnimation()&&selectedMarker.setAnimation(null),(selectedMarker=o).setAnimation(google.maps.Animation.BOUNCE),map.panTo(o.getPosition())}(o))}function closeInfoWindowAndStopAnimation(){largeInfoWindow&&largeInfoWindow.close(),selectedMarker&&null!==selectedMarker.getAnimation()&&selectedMarker.setAnimation(null)}function mapErrorHandler(){window.alert("Load Google Map APIs Failed")}var map,geocoder,largeInfoWindow,selectedMarker,markers=[],initialLocations=[];initLocationsData(),function(o){var e=function(o){var e=this;e.location=o,e.title=ko.observable(o.title),e.visible=ko.observable(!0)};ko.applyBindings(new function(){var o=this;o.menuToggle=ko.observable(!1),o.inputText=ko.observable(""),o.locations=ko.observableArray(),initialLocations.forEach(function(n){o.locations.push(new e(n))}),o.onSelectLocation=function(e){var n=o.locations.indexOf(e);-1!=n&&largeInfoWindow&&populateInfoWindow(markers[n],largeInfoWindow)},o.onFilterLocations=function(){closeInfoWindowAndStopAnimation();for(var e,n,t=o.inputText().toLowerCase(),i=0;i<o.locations().length;i++)e=o.locations()[i].title(),n=""===t||-1!==e.toLowerCase().indexOf(t),o.locations()[i].visible(n),markers[i]&&markers[i].setVisible(n)},o.onSwitchMenu=function(){o.menuToggle(!o.menuToggle())},o.onEnterKeyPress=function(e,n){return 13!=n.which||(o.onFilterLocations(),!1)}})}(window);